# MySQL中的锁

MySQL的锁机制比较简单,最显著的特点是不同的数据引擎支持不同的锁

- InnoDB 支持行锁、表锁

- MySIAM 只支持表锁

| 锁类型 | 开销   | 加锁速度 | 粒度     | 死锁         | 发生锁冲突概率     | 并发度   |
| ------ | ------ | -------- | -------- | ------------ | ------------------ | -------- |
| 表锁   | 开销小 | 加锁快   | 锁粒度大 | 不会出现死锁 | 发生冲突的概率低   | 并发度低 |
| 行锁   | 开销大 | 加锁慢   | 锁粒度小 | 会出现死锁   | 发生锁冲突的概率高 | 并发度高 |

## InnoDB 锁类型

- [读锁](#读锁)

- [写锁](#写锁)

- MDL锁

- 意向锁

- 行锁种类

  - record锁(单记录锁)

  - Gap(间隙锁)

  - 单记录锁和间隙锁的组合(next-key-锁)

    > 普通索引默认的就是 next-key 锁

## 读锁

共享锁又称读锁 , 简称 S 锁, 共享锁就是多个事务对统一数据可以共享一把锁,都能访问到数据,但是只能读不能修改

加锁语法

```sql
select * from student where id = 1 LOCK IN SHARE MODE;
```

## 写锁

排它锁又称写锁,简称 X 锁, 排它锁不能与其他锁共存,如一个事务获取了一个数据行的排他锁,其他事务就不能再获取该行的锁(共享锁或者排它锁), 只有该获取了排它锁的事务是可以对数据行进行读取和修改

加锁语法

```SQL
自动 :  delete / update / insert 默认加上 X 锁
手动 : select * from student where id = 1 FOR UPDATE
```



