# 06-MySQL体系结构

[TOC]

![image-20200313205854335](../../../assets/image-20200313205854335.png)

##  模块详解

- Connector: 用来支持各种语言和 SQL 的交互，比如 PHP，Python，Java 的 JDBC;
- Management Serveices & Utilities: 系统管理和控制工具，包括备份恢复,MySQL 复制、集群等等;
- Connection Pool: 连接池，管理需要缓冲的资源，包括用户密码权限线程等
- SQL Interface: 用来接收用户的 SQL 命令，返回用户需要的查询结果
- Parser: 用来解析 SQL 语句;
- Optimizer: 查询优化器;
- Cache and Buffer: 查询缓存，除了行记录的缓存之外，还有表缓存，Key 缓存，权限缓存等等;
-  Pluggable Storage Engines:插件式存储引擎，它提供 API 给服务层使用，跟具体的文件打交道。

## 架构分层

总体上，我们可以把 MySQL 分成三层，跟客户端对接的连接层，真正执行操作的服务层，和跟硬件打交道的存储引擎层(参考 **MyBatis:接口**、**核心**、**基础**)

![image-20200313210106783](../../../assets/image-20200313210106783.png)

## 连接层

我们的客户端要连接到 MySQL 服务器 3306 端口，必须要跟服务端建立连接，那么 管理所有的连接，验证客户端的身份和权限，这些功能就在连接层完成。

值得注意的是,**连接层为每一个连接分配一个对应的线程**

## 服务层

连接层会把 SQL 语句交给服务层，这里面又包含一系列的流程:
比如查询缓存的判断、根据 SQL 调用相应的接口，对我们的 SQL 语句进行词法和语 法的解析(比如关键字怎么识别，别名怎么识别，语法有没有错误等等)。
然后就是优化器，MySQL 底层会根据一定的规则对我们的 SQL 语句进行优化，最 后再交给执行器去执行。

- 权限判断

  > 审核用户有没有访问某个库,某个表的权限

-  [查询缓存](02-查询缓存.md) 

  > 通过 queryCache 进行操作,如果数据在 QueryCache 中,那么直接返回

- 解析器

  > 查询解析器主要针对 SQL 语句进行解析,判断语法是否正确

- 预处理器

  > 对解析器无法解析的语义进行处理

- 查询优化器

  > 对 SQL 进行改写和相应优化,并生成最优的执行计划

- 缓存和执行计划

## 存储引擎

存储引擎就是我们的数据真正存放的地方，在 MySQL 里面支持不同的存储引擎。 再往下就是内存或者磁盘。