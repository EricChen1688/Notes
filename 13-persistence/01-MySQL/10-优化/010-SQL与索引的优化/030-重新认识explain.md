# 重新认识 explain 

查看 explain 生成的执行计划 

- **先看 type , 如果出现 all 关键字,后面的内容就不用看了, 全表扫描**
- 再看 key 列, 看是否使用了索引, null 代表没有使用索引, 
- 然后看 rows 列, 该列用来表示在 SQL 执行过程中被扫描的行数,该数值越大,意味着需要扫描的行数越多,相应的耗时就会越长
- 最后看 extra 列, 在这个列中要观察是否有 Using filesort 或者 Using temporary 这样的关键字出现,这是很影响数据库性讷讷个

MySQL 5.7 的执行计划会默认添加 filterred 列, MySQL 5.6 使用 explain extended 也会增加此列,它指返回结果的行占需要读到的行(rows 列 的值) 的百分比 , 

## 如何针对优化

- 先看表的数据类型是否涉及的合理,有没有遵循选取数据类型越简单越小的原则

- 表中的碎片是否整理

- 表中的统计信息是否收集,只有统计信息准确,执行计划才可能帮我们优化 SQL

- 查看执行计划,检查索引的使用情况,如果没有用到索引,考虑创建

- 在创建索引之前,还要查看索引的选择性(离散度),来判断这个字段是否合适创建索引

  > 所谓创建索引,是指不重复的索引值(也成为基数,cardinality) 和数据表的记录总数的比值,索引的选择新越高则查询的效率越高(越接近于 1 越高) , 因为选择性高的索引可以让 MySQL 在查询的时候过来到更多行,主键索引和唯一索引的选择性是 1 ,这是最好的索引选择性,性能也是最好的

- 创建索引之后,再看一下执行计划,对比这两次的结果,看是否查询效率提高了

## 离散度的获取方式

```java
select count(distinct name)/count(*) from user_innodb;
```

