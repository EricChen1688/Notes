# 多量程读取优化-MRR

Muti-Range Read Optimization  简称 MR优化

## 一句话总结

MRR 的原理很简单

- 把普通索引的叶子节点上找到主键值的集合存储到 read_rnd_buffer 中
- 在 read_rnd_buffer 中对这些主键进行排序

- 利用这些排序号的的主键的集合,器访问表中的数据,这样原来的随机 IO就编程了顺序 IO,降低了查询过程中的 IO 开销

## 目的

MRR 的优化就是为了减少磁盘的随机访问,并且将随机访问转化较为顺序的数据访问 , 这对于 IO-bound 类型的 SQL 语句带来性能极大的提升

muti-range-read 优化可适用于 range , ref,  eq_ref 类型的查询

## 好处

- MRR 使 数据访问变得较为顺序, 在查询辅助索引的时候, 首先根据得到的查询结果,按照主键进行排序,并按照主键排序的顺序进行书签查找
- 减少缓冲池中页被替换的次数
- 批量处理对键值的查询操作

对于 InnoDB 和 MyISAM 存储引擎的范围查询 和 JOIN 查询, MRR 的工作方式如下

- 将查询得到的辅助索引的值存放于一个缓冲中,这时缓冲中的数据是根据辅助索引值排序的
- 将缓冲中的键值根据 RowID 进行排序
- 根据 RowId 的排序顺序来访问实际的数据文件

此外, 如果 InnoDB 存储引擎或者 MyISAM 存储引擎的缓冲池不是足够大,即不能放下一张表中的所有数据,此时频繁地离散度操作还会导致缓存中的页被替换出缓冲池,然后又不断地被读入缓冲池

若是按照主键顺序进行访问, 则可以将此重复行为降为最低