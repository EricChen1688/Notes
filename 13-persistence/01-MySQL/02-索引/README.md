# 索引

## 目录

- [索引是什么](#索引是什么)
- [索引类型](#索引类型)
- [索引的优点](#索引的优点)
- [索引创建四不要](#索引创建四不要)
- [使用不到索引的情况](#使用不到索引的情况)

## 索引是什么

> 数据库索引，是数据库管理系统(DBMS)中一个排序的数据结构，以协助快速查询、 更新数据库表中数据。

索引是应用程序设计和开发的重要方面

- 若索引太多,应用程序的性能可能会受到影响
- 若索引太少,对查询性能又会产生影响

要找到一个合适的平衡点,这对应用程序的性能至关重要

![image-20200825092839258](../../../assets/image-20200825092839258.png)

## InnoDB存储引擎索引

- B+树索引

  > B+树索引 就是传统意义上的索引,这是目前关系型数据库系统中查找最为常用和最为有效的索引, B+ 树索引的构造类似于二叉树,根据键值 key value 快速找到数据

- 全文索引

- 哈希索引

  > InnoDB 存储引擎会根据表的使用情况自动为表生成哈希索引,不能人工创建哈希索引

## 索引类型

#### 索引类型

- 普通索引(Normal): 最普通的索引,没有任何限制
- 唯一(Unique): 要求建值不能重复,另外需要注意的是,主键是一种特殊的唯一索引,它还多了一个限制条件,键值不能为空.主键索引用 primay key 创建。
- 全文(FullText):针对比较大的数据，比如我们存放的是消息内容，有几 KB 的数 据的这种情况，如果要解决 like 查询效率低的问题，可以创建全文索引。只有文本类型 的字段才可以创建全文索引，比如 char、varchar、text。

```
create table m3 ( name varchar(50), fulltext index(name) );
```

全文索引的使用:

```sql
select * from fulltext_test where match(content) against('咕泡学院' IN NATURAL LANGUAGE MODE);
```

MyISAM 和 InnoDB 支持全文索引。

## 索引的优点

- 提高数据检索效率
- 提高聚合函数效率
- 提高排序效率
- 使用覆盖索引可以避免会标

## 索引创建四不要

1. 离散度低的字段不要创建索引,例如 性别 gender
2. 很少查询的列不要创建索引
3. 大数据类型字段不要创建索引
4. 尽量避免不要使用 NULL, 应该制定列为 not null ,在 MySQL 中,含有空值的列很难进行查询优化,他们会使用索引,索引的统计信息以及比较运算更加复杂,可以使用空字符串替换空值

## 使用不到索引的情况

- 通过索引扫描的行记录数超过全表的 30% ,优化器就不会走索引,而变成全表扫描

- 联合索引中,第一个查询条件不是最左索引列

- 联合索引中,第一个索引列使用范围查询,只能使用到部分索引,有 ICP 的出现

  >  范围查询指的 <   >   <=  between and

- 联合索引中,第一个查询条件不是最左前缀列
- 模糊查询条件最左以通配符 %开始(可以考虑放到子查询中)
- 两个单列索引,一个用于检索,一个用于排序,这种情况下只能使用到一个索引,因为查询语句中最多只能使用一个索引,考虑建立联合索引
- 查询字段上面有索引,但是使用函数运算