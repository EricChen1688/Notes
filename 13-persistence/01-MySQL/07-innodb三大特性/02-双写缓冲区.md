# 双写缓冲( Double Write)

插入缓冲带来的是针对普通索引插入性能的提升,而 double Write 就是保证写入的安全性, 防止 MySQL 实例发生宕机时,InnoDB 发生数据页  **部分页写(partial page write) ** 的问题

这个时候我们就要问了

不是有 redolog 吗, 为什么不用 redolog 恢复

当数据库实例崩溃时, 使用 redolog 进行恢复,不会有任何问题,但是如果 **redolog 文件记录的是页的物理地址, 如果页都孙欢了,是无法进行任何恢复操作的**

#### 解决办法

我们需要一个页的副本,如果实例宕机了,可以先通过副本把原来的也还原,然后再通过 redolog 进行恢复,重做

这就是 双写缓冲的的作用

## 双写缓冲是如何做到的

双写缓冲是一个位于系统表空间中的存储区域

- 当 InnoDB 缓冲池中刷出脏页在被写入数据文件之前,都会先写入双写缓冲区
- 然后从 **双写缓冲区** 分两次,每次将 1MB 大小的数据写入磁盘共享表空间
- 最后再从 double write buffer 写入数据文件

虽然数据总是写两次,但是两次写缓冲并不需要两次 IO 开销, 数据被写入双写缓冲后, 其本身就是一个大型的连续块,会通过一次 fsync() 通知操作系统

## 配置

双写缓冲在默认场景下都是有效的,可以通过设置 innodb_doublewrite 为 0 来关闭双写缓冲

