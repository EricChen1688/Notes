# Scan

key的缺点:

- 遍历算法,时间复杂度 O(n)
- 因为 Redis 是单线程,所有使用key 会影响性能
- 没有分页参数

## Scan

- 复杂度 O(n), 但是通过游标分步进行,不会阻塞线程
- 提供 limit 参数,每次返回结果的最大条数 ,limit 只是一个 hint 返回结果可以多可以少
- 提供模式匹配
- 服务端不需要为游标保存状态,游标的唯一状态就是 scan返回给客户端的游标证书
- 返回的结果可能有重复,需要客户端去重,这个非常重要
- 遍历过程中如果有数据修改,改动后的数据能不能遍历到不确定
- 单次返回结果是空并不意味着建立结束,而要看返回的游标值是否为零

```
127.0.0.1:6379> scan 0 match key99* count 1000
1) "100672"
2) 1) "key99073"
   2) "key99130"
   3) "key99638"
   4) "key99039"
   5) "key99193"
127.0.0.1:6379> scan 0 match key99* count 100
1) "57856"
2) (empty list or set)
127.0.0.1:6379> scan 0 match key99* count 10
1) "118784"
2) (empty list or set)
127.0.0.1:6379> scan 0 match key99* count 1
```



- limit 不是先定返回结果的数量,而是遍历了多少个槽位