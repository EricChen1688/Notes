# Redis key 过期策略

### 主动删除

- [定时删除](#定时删除)

  > 在设置键的过期时间的同时,创建一个定时器(timer) , 让定时器在键的过期时间来临时,立即执行对键的删除操作

- [定期删除](#定期删除)

  > 每隔一段时间,程序就对数据库进行一次检查,删除里面的过期键,至于要删除多少过期键,以及要检查多少个数据库,由算法决定

### 被动策略

- [惰性删除](#惰性删除)

  > 放任键过期不管,每次客户端 get ,每次从键空间中获取键时, 都检查取得键是否过期,如果过期的话,就删除这个键,如果没有过期就返回这个键

  

## 定时删除

Redis 会将每个设置了过期时间的 **key** 放入一个独立的字典中,以后会定时遍历这个字典来删除过期的 key

该策略可以立即清除过期的数据，对内存很友好;

但是会占用大量的 CPU 资源去处理过期的 数据，从而影响缓存的响应时间和吞吐量。

#### 定时扫描

Redis 定时扫描默认是每秒进行 10 次过期扫描,过期扫描不会遍历过期字典中的所有的 key,而是采用了一种贪心策略

1. 从过期字典中随机选择 20 个 key
2. 删除这20 个key 中已经过期的 key
3. 如果过期的 key 的比例超过 1/4, 那么就重复步骤 1

> 为了防止线程卡死,算法增加了扫描时间的上限,默认是 25ms

## 惰性删除

只有当访问一个 key 时，才会判断该 key 是否已过期，过期则清除。该策略可以最 大化地节省 CPU 资源，却对内存非常不友好。极端情况可能出现大量的过期 key 没有再 次被访问，从而不会被清除，占用大量内存。