# 010-我们为什么需要集群

[TOC]

## 我们为什么需要集群

**Redis 集群是一个分布式（distributed）、容错（fault-tolerant）的 Redis 实现**

- 容错: 容错是指集群中的一个节点挂掉,不会影响其他节点

Redis 集群不存在中心节点(central) 或者代理节点,集群的其中一个主要涉及目标是达到**线性可拓展性[linear scalability]**

Redis 集群为了保证一致性(consistency) 而牺牲了一部分容错性: 系统会保证对网络断线(net split) 和节点失效(node failure)具有优先的抵抗力的前提下,尽可能地保证数据一致性

> 集群将节点失效视为网络断线的其中一种特殊情况。

# 为什么需要 Redis 集群

#### 性能

Redis 本身的 QPS 已经很高了，但是如果在一些并发量非常高的情况下，性能还是 会受到影响。这个时候我们希望有更多的 Redis 服务来完成工作。

#### 拓展

第二个是出于存储的考虑。因为 Redis 所有的数据都放在内存中，如果数据量大， 很容易受到硬件的限制。升级硬件收效和成本比太低，所以我们需要有一种横向扩展的 方法。

#### 可用性

第三个是可用性和安全的问题。如果只有一个 Redis 服务，一旦服务宕机，那么所有的客户端都无法访问，会对业务造成很大的影响。另一个，如果硬件发生故障，而单 机的数据无法恢复的话，带来的影响也是灾难性的。

可用性、数据安全、性能都可以通过搭建多个 Reids 服务实现。其中有一个是主节 点(master)，可以有多个从节点(slave)。主从之间通过数据同步，存储完全相同的数据。如果主节点发生故障，则把某个从节点改成主节点，访问新的主节点。

#### 分布式系统领域有个重要的 CAP 理论

| CAP                 | 解释       | 详解                                                         |
| ------------------- | ---------- | ------------------------------------------------------------ |
| Consistency         | 数据一致性 | 数据在存在多副本的情况下,可能由于网络,机器故障,软件系统等问题导致数据写入部分副本成功,部分副本失败,进而造成副本之间数据不一致,存在冲突,满足一致性要求对数据的更新操作完成之后,多副本的数据保持一致 |
| Availability        | 可用性     | 在任何时候,客户端对集群进行读写操作时,请求能够正常相应,即在一定的延时内完成 |
| Partition Tolerance | 分区容忍性 | 发生通讯故障的时候,整个集群被分割为多个无法相互通讯的分区时,集群仍然可用 |

对于分布式系统来说,一般网络条件相对不可控,出现网络分区是不可避免的,所以系统必须具备**分区容忍性**

**在分布式系统中,P 是一个客观存在的事实**

往往分布式系统设计在 AP 和 CP 之间选择

对于 Zookeeper ,它是"CP"的,之所以 C 加引号是因为 Zookeeper 默认并不是严格的强一致,比如客户端 A 提交了一个写操作,Zookeeper 在过半数节点操作成功之后就返回,此时假设客户端 B 的读操作请求到的是 A 写操作尚未同步到的节点,那么读取的就不是客户端 A写操作成功之后的数据

