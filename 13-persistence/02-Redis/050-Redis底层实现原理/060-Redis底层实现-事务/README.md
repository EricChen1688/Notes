# 060-Redis底层实现-事务

> Redis 事务不具备原子性,这个一定要注意,如果中间一步不限错误,那么后面的步骤依然会执行,仅仅只支持事务隔离级别中串行化

我们知道 Redis 的单个命令是原子性的(比如 get set mget mset)，如果涉及到 多个命令的时候，需要把多个命令作为一个不可分割的处理序列，就需要用到事务。

例如我们之前说的用 setnx 实现分布式锁，我们先 set，然后设置对 key 设置 expire， 防止 del 发生异常的时候锁不会被释放，业务处理完了以后再 del，这三个动作我们就希 望它们作为一组命令执行。

Redis 的事务有两个特点: 

- 按进入队列的顺序执行。

- 不会受到其他客户端的请求的影响。

Redis 的事务涉及到四个命令:

- multi(开启事务)
- exec(执行事务)
- discard (取消事务)
- watch(监视)

##  对于服务端来说

所有的指令在 exec 之前都不执行,而是缓存在服务器的一个事务队列中,服务器一旦受到 exec指令,才开始执行整个事务,执行完成后一次性返回所有指令的运行结果

- discard 丢弃
- watch 监视

