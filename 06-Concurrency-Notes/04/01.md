[返回目录](/README.md)

[返回本章目录](/04/README.md)

# 设计线程安全的类

设计线程安全类的三个要素：

- 确定对象状态是由哪些变量构成的；
- 确定限制状态变量的不变约束；
- 制定一个管理并发访问对象状态的策略。

## 收集同步需求

要确保类的线程安全性，就需要去确保它在并发访问的情况下下，不变性条件不会被破坏。

状态空间越小，就越容易判断线程的状态。final类型的域使用的越多，就越能够简化对象可能状态的分析过程。

## 依赖状态的操作

如果在某个操作中包含有基于状态的先验条件，那么这个操作就称为依赖状态的操作。

在某些独享的方法中还包含一些基于状态的先验条件（Precondiction）。例如：不能从空队列中逸出元素，所以要在删除元素前，队列必须处于非空状态。那么验证是否为空这个操作及称为依赖状态的操作。

在单线程中，不存在问题，在多线程情况下，先验条件有可能会由于其他线程的执行而变成真。