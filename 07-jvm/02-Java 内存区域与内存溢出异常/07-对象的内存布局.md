# 对象的内存布局

对象在内存中的布局,可以划分为 3 块部分:

- 对象头(header)
- 实例数据 Instance Data
- 对齐填充(Padding)

## 对象头

- MarkWord , 存储对象自身的运行时数据
- 类型指针.对象指向它的类元数据的指针,虚拟机通过这个指针来确定这个对象时哪个类的实例,如果对象是一个 Java数组,那再对象头中还必须提供一块用于记录数组长度的数据,因为从数组的元数据中无法确定数组的大小

## HotSpot 虚拟机对象头 Mark Word

#### MarkWord 内存大小

- 32 位系统: 32bit
- 64 位系统: 64bit

如果32位系统且未锁定

- 25bit 对象HashCode
- 4 bit 存储对象分代年龄
- 2 bit 用于存储锁标志位
- 1 bit 固定为0 

如果是其他非锁定状态 , 如下表:

| 存储内容                            | 标志位 | 状态           |
| ----------------------------------- | ------ | -------------- |
| 对象的哈希吗,对象分代年龄           | 01     | 未锁定         |
| 指向锁记录的指针                    | 00     | 轻量级锁定     |
| 指向重量级锁的指针                  | 10     | 膨胀(重量级锁) |
| 空,不需要记录信息                   | 11     | GC 标记        |
| 偏向线程 ID,偏向时间戳,对象分代年龄 | 01     | 可偏向         |



