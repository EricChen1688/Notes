# 收集器日志 G1

https://blogs.oracle.com/poonam/understanding-g1-gc-logs

## 启动G1

```
-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -Xloggc:g1-gc.log -XX:+UseG1GC
```

## 命令行

```
CommandLine flags: -XX:-BytecodeVerificationLocal -XX:-BytecodeVerificationRemote -XX:InitialHeapSize=536870912 -XX:+ManagementServer -XX:MaxHeapSize=8589934592 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:TieredStopAtLevel=1 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC 

```

- 可以看到 -XX:+UseG1GC 

<img src="../../assets/image-20200908114457778.png" alt="image-20200908114457778" style="zoom:67%;" />

## 日志

堆内存的使用率达到45%

```
[Times: user=0.02 sys=0.01, real=0.01 secs] 
2020-09-10T16:44:18.677-0800: 1.312: [GC pause (Metadata GC Threshold) (young) (initial-mark), 0.0104708 secs]
   [Parallel Time: 5.3 ms, GC Workers: 6]
      [GC Worker Start (ms): Min: 1311.9, Avg: 1312.0, Max: 1312.2, Diff: 0.3]
      [Ext Root Scanning (ms): Min: 1.0, Avg: 1.1, Max: 1.3, Diff: 0.4, Sum: 6.8]
      [Update RS (ms): Min: 0.0, Avg: 0.1, Max: 0.3, Diff: 0.3, Sum: 0.7]
         [Processed Buffers: Min: 0, Avg: 0.5, Max: 1, Diff: 1, Sum: 3]
      [Scan RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]
      [Code Root Scanning (ms): Min: 0.0, Avg: 0.2, Max: 0.5, Diff: 0.5, Sum: 1.2]
      [Object Copy (ms): Min: 3.3, Avg: 3.6, Max: 3.9, Diff: 0.6, Sum: 21.6]
      [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.1]
         [Termination Attempts: Min: 1, Avg: 17.7, Max: 24, Diff: 23, Sum: 106]
      [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]
      [GC Worker Total (ms): Min: 4.8, Avg: 5.1, Max: 5.2, Diff: 0.3, Sum: 30.5]
      [GC Worker End (ms): Min: 1317.0, Avg: 1317.0, Max: 1317.1, Diff: 0.0]
   [Code Root Fixup: 0.1 ms]
   [Code Root Purge: 0.0 ms]
   [Clear CT: 0.1 ms]
   [Other: 5.0 ms]
      [Choose CSet: 0.0 ms]
      [Ref Proc: 4.8 ms]
      [Ref Enq: 0.0 ms]
      [Redirty Cards: 0.0 ms]
      [Humongous Register: 0.0 ms]
      [Humongous Reclaim: 0.0 ms]
      [Free CSet: 0.1 ms]
   [Eden: 82.0M(300.0M)->0.0B(290.0M) Survivors: 6144.0K->16.0M Heap: 89.7M(512.0M)->17.7M(512.0M)]
 [Times: user=0.03 sys=0.00, real=0.01 secs] 
2020-09-10T16:44:18.688-0800: 1.322: [GC concurrent-root-region-scan-start]
2020-09-10T16:44:18.691-0800: 1.326: [GC concurrent-root-region-scan-end, 0.0033212 secs]
2020-09-10T16:44:18.691-0800: 1.326: [GC concurrent-mark-start]
2020-09-10T16:44:18.691-0800: 1.326: [GC concurrent-mark-end, 0.0002759 secs]
2020-09-10T16:44:18.691-0800: 1.326: [GC remark 2020-09-10T16:44:18.691-0800: 1.326: [Finalize Marking, 0.0007276 secs] 2020-09-10T16:44:18.692-0800: 1.327: [GC ref-proc, 0.0005769 secs] 2020-09-10T16:44:18.693-0800: 1.327: [Unloading, 0.0016569 secs], 0.0031377 secs]
 [Times: user=0.01 sys=0.00, real=0.00 secs] 
2020-09-10T16:44:18.695-0800: 1.329: [GC cleanup 19M->17M(512M), 0.0003702 secs]
 [Times: user=0.00 sys=0.00, real=0.00 secs] 

```

## 使用GCViewer查看

#### 测试参数

```
-Xms100m -Xmx500m -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -Xloggc:cms-gc.log -XX:+UseG1GC 
```

#### gc-日志总览



| 关注点       | 值                      | ParallelGC 完全默认8G | UseG1GC | CMS-Xmx=500M值 |
| ------------ | ----------------------- | --------------------- | ------- | -------------- |
| 吞吐量       | Throughput              | 63.37%                | 96.95%  | **96.33%**     |
| 最小停顿时间 | Min pause               | 0.00513               | 0.00084 | **0.00043**    |
| 最大停顿时间 | Max pause               | 0.01853               | 0.02089 | **0.00891**    |
| 平均停顿时间 | Avg pause               | 0.01142               | 0.00853 | **0.00384**    |
| full gc 次数 | number of full gc pause | 1                     | 0       | 0              |
| gc 次数      | number of gc pause      | 5                     | **5**   | 9              |

**可以看到内存从200 设置成为 500 后吞吐量增强,停顿时间也变小了**