# ParallelScanvenge 垃圾收集器 吞吐量优先收集器

- 标记-复制算法
- 支持并行收集的多线程收集器
- 自适应调节策略是ps 垃圾收集器区别于 parNew 的重要区别

**ParallelScanvange 的关注点是尽可能地缩短垃圾收集时用户线程的停顿时间**

>  为了提高新生代垃圾收集效率而设计的垃圾收集器,关注点是吞吐量
>
>  自适应调节策略是 Parallel Scanvenge 收集器区别于 ParNew 收集器的重要特征

Parallel Scanvenge 基于多线程复制算法实现,在系统吞吐量上有很大的优化,可以更高效的利用 CPU 尽快完成垃圾收集任务

通过是自适应调节策略提高吞吐量,有三个参数可以调节
- [控制最大垃圾收集停顿时间](#控制最大垃圾收集停顿时间) `-XX:MaxGCPauseMillis`
- [控制吞吐量大小](#控制吞吐量大小)`-XX:GCTimeRatio`参数
- [控制自适应调节策略](#控制自适应调节策略)开启的`UseAdaptiveSizePolicy`参数

## 吞吐量

```
吞吐量 = 运行用户代码时间/(运行用户代码时间 + 垃圾收集时间)
```

比如 用户代码加上垃圾收集时间是 100 分钟,垃圾收集使用了 1 分钟, 那么吞吐量就是 99%

## 控制最大垃圾收集停顿时间

  -XX:MAXGCPauseMillis 参数 允许一个大于 0 的值

垃圾收集器将**尽量**保证内存回收花费的时间不超过用户设定的值, 垃圾收集器的停顿时间缩短是以牺牲吞吐量和新生代空间为代价换取的:

比如系统把新生代调的小一点,收集 300M 肯定比收集500 M 新生代块,但是也导致了垃圾收集发生得更加频繁, 原来 10s 收集一次,每次停顿 100 毫秒,现在变为 5s 收集一次,停顿 70ms,停顿时间确实下降了,但是吞吐量也下降了

## 控制吞吐量大小

`-XX:GCTimeRatio`参数的值应该是一个大于 0 小于 100 的整数,也就是垃圾收集时间占总时间的 5% (1/1+19), 默认值是 99 , 允许最大 1%(1/1+99) 的垃圾收集时间

## 控制自适应调节策略

`UseAdaptiveSizePolicy` 这个参数被激活后, 用户就不需要

- 人工指定新生代的大小 (-Xmn) .
- Eden ,Survior 区的比例(-XX : SurvivorRatio) 
- 晋升老年代对象代销(-XX: PretenureSizeThreshold) 等细节参数

虚拟机会根据当前时间的运行情况收集性能监控信息,动态调整这些参数以提供最合适的停顿时间最大的吞吐量,

这种调节方式成为垃圾收集的自适应调节策略(GC Ergonomics)

## 使用

如果新手,对收集器不了解,手工优化困难的话,直接使用这个收集器配合自适应调节策略,把内存管理的调优任务交给虚拟机去完成

我们要配置一些基本的参数

- -Xmx 设置最大堆
- -XX MaxGCPauseMillis 参数 ,更关注最大停顿时间
- -XX GCTimeRatio 更关注吞吐量

给虚拟机设定一个目标,那具体细节参数由虚拟机去完成

