# 上下文层次结构

`DispatcherServlet`需要一个`WebApplicationConetxt`(一个普通的 `ApplicationContext`的拓展)来进行自己的配置。`WebApplicationContext`有一个指向`ServletContext`和其关联的`Servlet`的链接,它还绑定到了`ServletContext`以便应用程序可以在`RequestContextUtils`上使用静态方法来查找需要访问的`WebApplicationContext`。

对于很多应用,拥有一个简单的` WebApplicationContext`就足够了,还可以有一个上下文层次结构，其中一个根`WebApplicationContext`在多个`DispatcherServlet`(或其他Servlet)实例之间共享，每个实例都有自己的子`WebApplicationContext`配置。

根`WebApplicationContext`通常包含基础设施 bean,比如需要跨多个 Servlet 实例共享数据库和业务服务.这些 Bean 可以有效地继承(重新声明),该上下文通常包含给定 Servlet 的本地 Bean,下图显示了这种关系

![mvc context hierarchy](assets/mvc-context-hierarchy-20190605145650772.png)



The following example configures a `WebApplicationContext` hierarchy:

```
public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class<?>[] getRootConfigClasses() {
        return new Class<?>[] { RootConfig.class };
    }

    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class<?>[] { App1Config.class };
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { "/app1/*" };
    }
}

```

或者使用 xml 形式:

```xml
<web-app>

    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>

    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>/WEB-INF/root-context.xml</param-value>
    </context-param>

    <servlet>
        <servlet-name>app1</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/app1-context.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>app1</servlet-name>
        <url-pattern>/app1/*</url-pattern>
    </servlet-mapping>

</web-app>
```