# Eureka 的设计理念

3 个核心问题

- 服务实例如何注册到服务中心
- 服务实例如何从服务中心剔除
- 服务实例信息一致性

## 服务实例如何注册到服务中心

本质上是服务启动的时候,调用 Eureka Server 的 REST API 的 register 方法,去注册这个应用的实例

## 服务实例如何从服务中心剔除

正常情况下,服务实例在关闭应用的时候,通过钩子方法或者其他生命周期回调去调用 Eureka Server 的 REST API 的 de-register 方法来删除自身服务实例的信息

服务实例挂掉的情况下: 使用心跳包来证明服务实例还是存活的,是健康的,是可以条用的; Eureka 采用的是心跳模式

## 服务实例信息一致性

服务注册以及发现中心不可能是单点的,势必是一个集群,那么服务实例注册信息如何在这个集群里保证一致呢?

- AP 优于 CP
- Peer to Peer 架构
- Zone 以及 Region 设计
- self preservation 设计

### AP 优于 CP

分布式系统领域有个重要的 CAP 理论

| CAP                 | 解释       | 详解                                                         |
| ------------------- | ---------- | ------------------------------------------------------------ |
| Consistency         | 数据一致性 | 数据在存在多副本的情况下,可能由于网络,机器故障,软件系统等问题导致数据写入部分副本成功,部分副本失败,进而造成副本之间数据不一致,存在冲突,满足一致性要求对数据的更新操作完成之后,多副本的数据保持一致 |
| Availability        | 可用性     | 在任何时候,客户端对集群进行读写操作时,请求能够正常相应,即在一定的延时内完成 |
| Partition Tolerance | 分区容忍性 | 发生通讯故障的时候,整个集群被分割为多个无法相互通讯的分区时,集群仍然可用 |

对于分布式系统来说,一般网络条件相对不可控,出现网络分区是不可避免的,所以系统必须具备**分区容忍性**

**在分布式系统中,P 是一个客观存在的事实**

往往分布式系统设计在 AP 和 CP 之间选择

对于 Zookeeper ,它是"CP"的,之所以 C 加引号是因为 Zookeeper 默认并不是严格的强一致,比如客户端 A 提交了一个写操作,Zookeeper 在过半数节点操作成功之后就返回,此时假设客户端 B 的读操作请求到的是 A 写操作尚未同步到的节点,那么读取的就不是客户端 A写操作成功之后的数据



