# 05-锁的内存语义

## 锁的释放 - 获取简历的 happens-before 关系

- 锁的释放和 volatile 写有相同的内存语义

- 锁的获取和 volatile 读有相同的内存语义

总结:

- 线程 A 释放一个锁,实质上是线程 A向接下来将要获取这个锁的某个线程发出了(线程 A 对共享变量有所修改) 的消息
- 线程 B 获取一个锁,实际上是线程 B 接受了之前某个线程发出的(在释放这个锁之前对共享变量做出的修改)的消息
- 线程 A 释放锁, 随后线程 B 获取这个锁,这个过程实际上是线程 A 通过主内存想线程 B 发送消息



## 通俗讲

#### 写入volatile变量就像是退出同步块

线程 A 释放一个锁,实质上是线程 A向接下来将要获取这个锁的某个线程发出了(线程 A 对共享变量有所修改) 的消息

#### 读取volatile变量就像是进入同步块

线程 B 获取一个锁,实际上是线程 B 接受了之前某个线程发出的(在释放这个锁之前对共享变量做出的修改)的消息

