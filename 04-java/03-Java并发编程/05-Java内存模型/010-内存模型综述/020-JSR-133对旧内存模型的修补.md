# 020-JSR-133对旧内存模型的修补

[TOC]

## JSR-133对JDK5之前的旧内存模型的修补主要有两个

- 增强 volatile 的内存语义。
- 增强 final 的内存语义。


### 1.增强 volatile 的内存语义

旧内存模型允许 volatile 变量与普通变量重排序。JSR-133 严格限制 volatile 变量与普通变量的重排序，使 volatile 的写- 读和锁的释放 - 获取具有相同的内存语义。

### 2.增强 final 的内存语义

在旧内存模型中，多次读取同一个 final 变量的值可能会不相同。为此，JSR-133 为 final 增加了两个重排序规则。现在，final 具有了初始化安全性。

- **在对象引用为任意线程可见之前,对象的 final 域已经被正确地初始化了,而普通域不会有这个保障**

- 在读一个对象的 final 域 之前,一定会先读包含这个 final 域的对象的引用

<img src="../../../../assets/image-20200618083121813.png" alt="image-20200618083121813" style="zoom: 50%;" />

