# 原子更新基本类型类

# Java 中的 13 个原子操作类

从 JDK1.5开始, java.util.concurrent.atomic 包.提供了一种,用法简单,性能高效线程安全地更新一个变量的方式

#### 原子更新基本类型类

- AtomicBoolean : 原子更新 boolean类型
- AtomicInteger : 原子更新整型
- AtomicLong: 原子更新长整型

```java
/**
 * <p>
 * A Test of {@link AtomicInteger} and {@link Integer} increment
 * </p>
 *
 * @author EricChen 2020/04/07 12:55
 */
public class AtomicIntegerTest implements Runnable {
    private AtomicInteger atomicInteger = new AtomicInteger(0);
    public Integer integer = 0;
    private CountDownLatch countDownLatch;

    public AtomicIntegerTest(CountDownLatch countDownLatch) {
        this.countDownLatch = countDownLatch;
    }

    public static void main(String[] args) throws InterruptedException {
        CountDownLatch countDownLatch = new CountDownLatch(1000);
        AtomicIntegerTest atomicIntegerTest = new AtomicIntegerTest(countDownLatch);
        for (int i = 0; i < 10000; i++) {
            new Thread(atomicIntegerTest).start();
        }
        System.out.println("sum:" + atomicIntegerTest.getInteger());
        System.out.println("sumAto:" + atomicIntegerTest.getAtomicInteger());
        countDownLatch.await();
    }

    @Override
    public void run() {
        integer++;
        atomicInteger.incrementAndGet();
        countDownLatch.countDown();
    }

    public AtomicInteger getAtomicInteger() {
        return atomicInteger;
    }

    public void setAtomicInteger(AtomicInteger atomicInteger) {
        this.atomicInteger = atomicInteger;
    }

    public Integer getInteger() {
        return integer;
    }

    public void setInteger(Integer integer) {
        this.integer = integer;
    }

    public CountDownLatch getCountDownLatch() {
        return countDownLatch;
    }

    public void setCountDownLatch(CountDownLatch countDownLatch) {
        this.countDownLatch = countDownLatch;
    }
}

```

#### getAndIncrement 是如何实现原子操作的 

底层使用的是 cas + 自旋的机制

```
    public final int getAndIncrement() {
        return unsafe.getAndAddInt(this, valueOffset, 1);
    }

```

